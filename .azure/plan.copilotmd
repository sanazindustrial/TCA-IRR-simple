# Azure Deployment Plan for TCA-IRR Next.js Application

## **Goal**

Deploy the TCA-IRR investment analysis application to Azure using Azure Developer CLI (azd) with a scalable, secure, and cost-effective architecture optimized for production workloads.

## **Project Information**

**AppName**: tca-irr-app

- **Technology Stack**: Next.js 15.3.3 with React 18.3.1, TypeScript, Tailwind CSS
- **Application Type**: Investment analysis and evaluation platform with AI-powered insights
- **AI Integration**: Google GenAI integration for analysis flows
- **Features**:
  - Comprehensive startup evaluation modules
  - Real-time analysis dashboards
  - Document generation (PDF, DOCX, PPTX)
  - User authentication and role-based access
  - Module configuration system
- **Dependencies**: Firebase (authentication), Google GenAI APIs
- **Hosting Recommendation**: Azure Static Web Apps with Azure Functions for API routes

## **Azure Resources Architecture**
>
> **Install the mermaid extension in IDE to view the architecture.**

```mermaid
graph TB
    subgraph "Frontend Tier"
        SWA[Azure Static Web Apps<br/>Next.js Frontend]
    end
    
    subgraph "Backend Tier"
        FUNC[Azure Functions<br/>API Routes]
        GENAI[Google GenAI<br/>External Service]
    end
    
    subgraph "Data Tier"
        FIREBASE[Firebase<br/>Authentication & Database]
        STORAGE[Azure Storage<br/>Documents & Files]
    end
    
    subgraph "Monitoring & Security"
        AI[Application Insights<br/>Telemetry]
        KV[Azure Key Vault<br/>API Keys & Secrets]
        LOG[Log Analytics<br/>Centralized Logging]
    end
    
    SWA --> FUNC
    FUNC --> GENAI
    FUNC --> FIREBASE
    FUNC --> STORAGE
    SWA --> FIREBASE
    FUNC --> KV
    AI --> LOG
    SWA --> AI
    FUNC --> AI
```

**Data Flow**:

- Static web content is served from Azure Static Web Apps CDN
- API routes are handled by Azure Functions with automatic scaling
- Authentication is managed through Firebase
- AI analysis requests flow through Azure Functions to Google GenAI
- Generated documents are stored in Azure Storage
- Secrets and API keys are securely stored in Azure Key Vault

## **Recommended Azure Resources**

**Primary Application Hosting**

- Application: tca-irr-app
  - Hosting Service Type: Azure Static Web Apps (Standard tier)
  - SKU: Standard (Custom domains, advanced security, SLA 99.95%)
  - Configuration:
    - Language: Node.js 18
    - Build Command: `npm run build`
    - App Location: `/`
    - API Location: `/api`
    - Output Location: `out`
    - Environment Variables:
      - `NEXT_PUBLIC_FIREBASE_CONFIG`
      - `GOOGLE_GENAI_API_KEY` (from Key Vault)
      - `NODE_ENV=production`

**API Backend**

- Azure Functions (Consumption Plan)
  - Runtime: Node.js 18
  - Configuration:
    - Trigger: HTTP
    - CORS: Configured for Static Web Apps domain
    - Environment Variables:
      - `GOOGLE_GENAI_API_KEY` (from Key Vault)
      - `FIREBASE_ADMIN_SDK_CONFIG` (from Key Vault)

**Supporting Services**

- **Azure Storage Account (Standard_LRS)**
  - Purpose: Document storage, file uploads
  - Features: Hot tier, HTTPS only, secure transfer required
  
- **Azure Key Vault (Standard)**
  - Purpose: Secure storage of API keys, connection strings
  - Secrets:
    - Google GenAI API key
    - Firebase admin SDK configuration
    - Any third-party service credentials

- **Application Insights**
  - Purpose: Application performance monitoring, error tracking
  - Features: Real-time metrics, custom telemetry, alerting

- **Log Analytics Workspace**
  - Purpose: Centralized logging and monitoring
  - Connected to: Static Web Apps, Functions, Application Insights

**Recommended Security Configurations**

- **Managed Identity**: System-assigned for Functions to access Key Vault
- **RBAC Assignments**:
  - Functions Managed Identity → Key Vault Secrets User role
  - Functions Managed Identity → Storage Blob Data Contributor role
- **Network Security**:
  - HTTPS enforcement on all services
  - CORS properly configured
  - Private endpoints for Key Vault (optional for enhanced security)
- **Authentication**:
  - Firebase Authentication integration
  - Static Web Apps built-in authentication as backup

## **Prerequisites**

### **Development Environment**

1. **Azure CLI** (latest version)

   ```powershell
   winget install Microsoft.AzureCLI
   ```

2. **Azure Developer CLI (azd)**

   ```powershell
   winget install Microsoft.Azd
   ```

3. **Node.js 18+** (already installed)

4. **Azure Subscription** with appropriate permissions

### **Azure Account Setup**

1. **Login to Azure**

   ```bash
   az login
   azd auth login
   ```

2. **Set Subscription** (if multiple)

   ```bash
   az account set --subscription "your-subscription-id"
   ```

### **Required API Keys**

1. **Google GenAI API Key**
   - Obtain from Google AI Studio
   - Required for AI analysis features

2. **Firebase Configuration**
   - Firebase project setup
   - Service account key for admin operations

## **Execution Steps**

> **Below are the steps for Copilot to follow; ask Copilot to update or execute this plan.**

### **Phase 1: Infrastructure Preparation**

1. **Generate Infrastructure as Code Files**
   - Create Azure Developer CLI configuration (`azure.yaml`)
   - Generate Bicep templates for all Azure resources
   - Configure deployment parameters

2. **Pre-deployment Validation**
   - Validate Bicep templates syntax
   - Check Azure quota availability
   - Verify resource naming conventions

### **Phase 2: Application Preparation**

1. **Configure Build for Static Web Apps**
   - Update `next.config.ts` for static export
   - Configure environment variables
   - Optimize build output

2. **Prepare Azure Functions**
   - Extract API routes to Azure Functions format
   - Configure function bindings
   - Set up local development environment

### **Phase 3: Deployment**

1. **Infrastructure Provisioning**
   - Run `azd provision --preview` to validate
   - Execute `azd provision` to create resources
   - Verify all resources are created successfully

2. **Application Deployment**
   - Deploy frontend to Static Web Apps
   - Deploy functions to Azure Functions
   - Configure custom domains (if needed)

3. **Configuration & Secrets**
   - Store API keys in Key Vault
   - Configure application settings
   - Set up monitoring and alerts

### **Phase 4: Validation**

1. **Functional Testing**
   - Verify application loads correctly
   - Test AI analysis features
   - Validate authentication flow

2. **Performance Testing**
   - Check page load times
   - Verify API response times
   - Test under load (optional)

3. **Security Validation**
   - Verify HTTPS enforcement
   - Check authentication integration
   - Validate secret storage

## **Cost Optimization**

- **Static Web Apps Standard**: ~$9/month (includes 100GB bandwidth)
- **Azure Functions Consumption**: Pay-per-execution (typically <$10/month for low-medium traffic)
- **Storage Account**: ~$1-5/month depending on usage
- **Key Vault**: ~$1/month for standard operations
- **Application Insights**: First 5GB/month free, then pay-per-GB

**Total Estimated Monthly Cost**: $15-30 for low to medium traffic

## **Post-Deployment Tasks**

1. **Configure CI/CD Pipeline**
   - Set up GitHub Actions integration
   - Configure automatic deployments

2. **Monitoring Setup**
   - Configure Application Insights dashboards
   - Set up alerts for errors and performance issues

3. **Backup Strategy**
   - Configure automated backups for critical data
   - Document recovery procedures

4. **Security Hardening**
   - Regular security reviews
   - Update dependencies regularly
   - Monitor for vulnerabilities
